NOTE: Gem.source_index is deprecated, use Specification. It will be removed on or after 2011-11-01.
Gem.source_index called from /home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/rails-2.3.14/lib/rails/gem_dependency.rb:21.
WARNING: HTML validation script /usr/local/bin/validate not found

LinkToHelper when creating a url for a request
- should return a path like /request/test_title
- should return a path including any extra parameters passed

LinkToHelper when appending something to a URL
- should append to things without query strings
- should append to things with query strings
- should fail silently with invalid URLs

LinkToHelper when displaying a user admin link for a request
- should return the text "An anonymous user (external)" in the case where there is no external username

LinkToHelper admin_url with no ADMIN_BASE_URL set
- should prepend the admin general index path to a simple string
- should prepend the admin general index path to a deeper URL

LinkToHelper admin_url with ADMIN_BASE_URL set
- should prepend the admin base URL to a simple string
- should prepend the admin base URL to a deeper URL

RequestMailer when receiving incoming mail
- should append it to the appropriate request
- should store mail in holding pen and send to admin when the email is not to any information request
- should store mail in holding pen and send to admin when the from email is empty and only authorites can reply
- should store mail in holding pen and send to admin when the from email is unknown and only authorites can reply
- should return incoming mail to sender when a request is stopped fully for spam
- should return incoming mail to sender if not authority when a request is stopped for non-authority spam
- should send all new responses to holding pen if a request is marked to do so
- should destroy the messages sent to a request if marked to do so
- should not mutilate long URLs when trying to word wrap them

RequestMailer when sending reminders to requesters to classify a response to their request
- should ask for all requests that are awaiting description and whose latest response is older
        than the number of days given and that are not the holding pen
- should raise an error if a request does not have a last response event id
- should check to see if an alert matching the attributes of the one to be sent has already been sent

RequestMailer when sending reminders to requesters to classify a response to their request if an alert matching the attributes of the reminder to be sent has already been sent
- should not send the reminder

RequestMailer when sending reminders to requesters to classify a response to their request if no alert matching the attributes of the reminder to be sent has already been sent
- should store the information that the reminder has been sent
- should send the reminder

RequestMailer when sending mail when someone has updated an old unclassified request
- should have the subject "Someone has updated the status of your request"
- should tell them what status was picked
- should contain the request path

RequestMailer requires_admin
- body should contain the full admin URL

RequestMailer requires_admin has an ADMIN_BASE_URL set
- body should contain the full admin URL

TrackMailer when sending email alerts for tracked things
- should ask for all the users whose last daily track email was sent more than a day ago

TrackMailer when sending email alerts for tracked things for each user
- should ask for any daily track things for the user
- should set the no_xapian_reindex flag on the user
- should update the time of the user's last daily tracking email
- should return true

TrackMailer when sending email alerts for tracked things for each user for each tracked thing
- should ask for the events returned by the tracking query
- should not include in the email any events that the user has already been sent a tracking email about
- should not include in the email any events not sent in a previous tracking email that were described before the track was set up
- should include in the email any events that the user has not been sent a tracking email on that have been described since the track was set up
- should raise an error if a non-event class is returned by the tracking query
- should record that a tracking email has been sent for each event that has been included in the email

TrackMailer when sending email alerts for tracked things when a user should not be emailed
- should not ask for any daily track things for the user
- should not ask for any daily track things for the user if they have receive_email_alerts off but could otherwise be emailed
- should not set the no_xapian_reindex flag on the user
- should not update the time of the user's last daily tracking email
- should return false

TrackMailer delivering the email
- should deliver one email, with right headers

OutgoingMessage when making an outgoing message
- should not index the email addresses
- should not display email addresses on page
- should link to help page where email address was
- should include email addresses in outgoing messages
- should work out a salutation

IncomingMessage when censoring data
- should apply censor rules to outgoing messages

PublicBody using tags
- should correctly convert a tag string into tags
- should strip spaces from tag strings
- should work with other white space, such as tabs and new lines
- changing tags should remove presence of the old ones
- should be able to append tags
- should ignore repeat tags

PublicBody using machine tags
- should parse machine tags
- should cope with colons in value
- should allow multiple tags of the same sort

PublicBody when finding_by_tags
- should be able to find bodies by string
- should be able to find when there are multiple tags in one body, without returning duplicates

PublicBody when making up the URL name
- should remove spaces, and make lower case
- should not allow a numeric name

PublicBody when saving
- should not be valid without setting some parameters
- should not be valid with misformatted request email
- should save
- should update first_letter

PublicBody when searching
- should find by existing url name
- should find by historic url name
- should cope with not finding any
- should cope with duplicate historic names
- should cope with same url_name across multiple locales
- should not raise an error on a name with a single quote in it

PublicBody when dealing public body locales
- shouldn't fail if it internal_admin_body was created in a locale other than the default

PublicBody when loading CSV files
- should import even if no email is provided
- should do a dry run successfully
- should do full run successfully
- should do imports without a tag successfully
- should handle a field list and fields out of order
- should import tags successfully when the import tag is not set
- should import tags successfully when the import tag is set
- should create bodies with names in multiple locales
- should not fail if a locale is not found in the input file

PublicBody calculated home page
- should return the home page verbatim if it's present
- should return the home page based on the request email domain if it has one
- should return nil if there's no home page and the email domain can't be worked out
- should ensure home page URLs start with http://
- should not add http when https is present

PublicBody when asked for notes without html
- should remove simple tags from notes

PublicBody when override all public body request emails set
- should return the overridden request email

ProfilePhoto when constructing a new photo
- should take no image as invalid
- should take bad binary data as invalid
- should accept and convert a PNG to right size
- should accept and convert a JPEG to right format and size
- should accept a draft PNG and not resize it

TrackThing when tracking changes
- requires a type
- requires a valid type
- requires a valid medium
- will find existing tracks which are the same
- can display the description of a deleted track_thing
- will make some sane descriptions of search-based tracks
- will create an authority-based track when called using a 'bodies' postfix

User manipulating a raw email
- putting data in comes back out

FoiAttachment when calculating due date
- sets the body
- sets the size
- reparses the body if it disappears

MailServerLog.load_file
- loads relevant lines of an uncompressed exim log file
- doesn't load the log file twice if it's unchanged
- loads the log file again if it's changed
- doesn't end up with two copies of each line when the same file is actually loaded twice
- easily handles gzip compress log files

MailServerLog.email_addresses_on_line
- recognises a single incoming email
- recognises two email addresses on the same line
- returns an empty array when there is an email address from a different domain
- ignores an email with a different prefix
- ignores an email where the . is substituted for something else

MailServerLog Postfix.load_postfix_log_data
- loads the postfix log and untangles seperate email transactions using the queue ID

MailServerLog Postfix.scan_for_postfix_queue_ids
- returns the queue ids of interest with the connected email addresses

MailServerLog Postfix.extract_postfix_queue_id_from_syslog_line
- returns nil if there is no queue id

MailServerLog Postfix.request_postfix_sent?
- returns true when the logs say the message was sent
- returns false when the logs say the message hasn't been sent

IncomingMessage when dealing with incoming mail
- should correctly parse multipart mails with a linebreak in the boundary marker
- should return the mail Date header date for sent at
- should be able to parse emails with quoted commas in
- should correctly fold various types of footer (FAILED - 1)
- should ensure cached body text has been parsed correctly (FAILED - 2)
- should correctly convert HTML even when there's a meta tag asserting that it is iso-8859-1 which would normally confuse elinks (FAILED - 3)
- should unquote RFC 2047 headers (FAILED - 4)
- should not error on display of a message which has no charset set on the body part and
        is not good utf-8 (FAILED - 5)
- should fold multiline sections

IncomingMessage when parsing HTML mail
- should display UTF-8 characters in the plain text version correctly (FAILED - 6)

IncomingMessage when getting the attachment text
Error processing zip file: #<NoMethodError: undefined method `close' for [#<Spec::Mocks::Mock:0x2a6cce4 @name="ZipFile entry">]:Array>
- should not raise an error if the expansion of a zip file raises an error

IncomingMessage display attachments
- should not show slashes in filenames
- should not show slashes in subject generated filenames

IncomingMessage folding quoted parts of emails
- should fold an example lotus notes quoted part converted from HTML correctly (FAILED - 7)
- should fold a plain text lotus notes quoted part correctly
- cope with [ in user names properly
- should fold an example of another kind of forward quoting (FAILED - 8)
- should fold a further example of forward quoting (FAILED - 9)

IncomingMessage checking validity to reply to
- says a valid email is fine
- says postmaster email is bad
- says Mailer-Daemon email is bad
- says case mangled MaIler-DaemOn email is bad
- says Auto_Reply email is bad
- says DoNotReply email is bad
- says a filled-out return-path is fine
- says an empty return-path is bad
- says an auto-submitted keyword is bad

IncomingMessage checking validity to reply to with real emails
- should allow a reply to plain emails
- should not allow a reply to emails with empty return-paths
- should not allow a reply to emails with autoresponse headers

IncomingMessage when censoring data
- should do nothing to a JPEG
- should replace censor text in Word documents
- should replace ASCII email addresses in Word documents
- should replace UCS-2 addresses in Word documents
- should replace everything in PDF files using pdftk (FAILED - 10)
- should replace everything in PDF files using ghostscript (FAILED - 11)
- should not produce zero length output if pdftk silently fails (FAILED - 12)
- should apply censor rules to HTML files
- should apply hard-coded privacy rules to HTML files
- should apply censor rules to From: addresses

IncomingMessage when censoring whole users
- should apply censor rules to HTML files
- should replace censor text to Word documents

IncomingMessage when uudecoding bad messages
- should be able to do it at all
- should apply censor rules

IncomingMessage when messages are attached to messages
- should flatten all the attachments out

IncomingMessage when Outlook messages are attached to messages
[08:31:28 /home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/ruby-msg-1.5.0/lib/mapi/property_set.rb:262:body_html]
WARN   creating html body from rtf
[08:31:28 /home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/ruby-msg-1.5.0/lib/mapi/property_set.rb:262:body_html]
WARN   creating html body from rtf
[08:31:28 /home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/ruby-msg-1.5.0/lib/mapi/property_set.rb:262:body_html]
WARN   creating html body from rtf
[08:31:29 /home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/ruby-msg-1.5.0/lib/mapi/property_set.rb:262:body_html]
WARN   creating html body from rtf
[08:31:29 /home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/ruby-msg-1.5.0/lib/mapi/property_set.rb:262:body_html]
WARN   creating html body from rtf
[08:31:29 /home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/ruby-msg-1.5.0/lib/mapi/property_set.rb:262:body_html]
WARN   creating html body from rtf
- should flatten all the attachments out

IncomingMessage when TNEF attachments are attached to messages
- should flatten all the attachments out (FAILED - 13)

InfoRequestEvent when storing serialized parameters
- should convert event parameters into YAML and back successfully

InfoRequestEvent after saving
- should mark the model for reindexing in xapian if there is no no_xapian_reindex flag on the object

InfoRequestEvent should know
- that it's an incoming message
- that it's an outgoing message
- that it's a comment

InfoRequestEvent doing search/index stuff
- should get search text for outgoing messages (FAILED - 14)
- should get search text for incoming messages (FAILED - 15)
- should get clipped text for incoming messages, and cache it too (FAILED - 16)

HasTagString::HasTagStringTag when fiddling with tag strings
- should be able to make a new tag and save it

PurgeRequest purging things
- should issue purge requests to the server
- should fail silently for a misconfigured server

ApplicationMailer when using plugins when a plugin prepends its mail templates to the view paths
- should render a theme template in preference to a core template
- should render the template provided by the theme if no template is available in core
- should render the template provided by core if there is no theme template
- should raise an error if the template is in neither core nor theme (FAILED - 17)
- should render a multipart email using a theme template
- should render a multipart email using a core template

ApplicationMailer when using plugins when a plugin appends its mail templates to the view paths
- should render a core template in preference to a theme template
- should render the template provided by the theme if no template is available in core
- should render the template provided by core if there is no theme template
- should raise an error if the template is in neither core nor theme (FAILED - 18)
- should render a multipart email using a core template
- should render a multipart email using a theme template

User making up the URL name
- should remove spaces, and make lower case
- should not allow a numeric name

User showing the name
- should strip whitespace
- should show if user has been banned

User when authenticating
- should create a hashed password when the password is set
- should have errors when given the wrong password
- should not find the user when given the wrong email
- should find the user when given the right email and password

User when saving
- should not save without setting some parameters
- should not save with misformatted email
- should not allow an email address as a name
- should not save with no password
- should save with reasonable name, password and email
- should let you make two users with same name
- should mark the model for reindexing in xapian if the no_xapian_reindex flag is set to false
- should mark the model for reindexing in xapian if the no_xapian_reindex flag is not set
- should not mark the model for reindexing in xapian if the no_xapian_reindex flag is set

User when reindexing referencing models
- should reindex events associated with that user's comments when URL changes
- should reindex events associated with that user's requests when URL changes

User when reindexing referencing models when no_xapian_reindex is set
- should not reindex events associated with that user's comments when URL changes
- should not reindex events associated with that user's requests when URL changes

User when checking abilities
- should not get admin links
- should be able to file requests

User when asked if a user owns every request
- should return false if no user is passed
- should return true if the user has "requires admin" power
- should return false if the user does not have "requires admin" power

User when making name and email address
- should generate a name and email
- should quote name and email with funny characters in the name

User when setting a profile photo
- should attach it to the user

User when unconfirmed
- should not be emailed

User when emails have bounced
- should record bounces

PostRedirect when constructing
- should generate a different token from email token
- should generate a different token each time
- should generate a different email each time
- should generate a URL friendly token
- should generate an email friendly email token

PostRedirect when accessing values
- should convert post parameters into YAML and back successfully
- should convert reason parameters into YAML and back successfully

Holiday when calculating due date in working days
- handles no holidays
- handles non leap years
- handles leap years
- handles Thursday start
- handles Friday start
- handles Saturday start
- handles Sunday start
- handles Monday start
- handles Time objects

Holiday when calculating due date in calendar days
- handles no holidays
- handles the due date falling on a Friday
- handles the due date falling on a Saturday
- handles the due date falling on a Sunday
- handles the due date falling on a Monday
- handles the due date falling on a day before a Holiday
- handles the due date falling on a Holiday
- handles Time objects

InfoRequest guessing a request from an email
- should compute a hash
- should find a request based on an email with an intact id and a broken hash
- should find a request based on an email with a broken id and an intact hash

InfoRequest making up the URL title
- should remove spaces, and make lower case
- should not allow a numeric title

InfoRequest when asked for the last event id that needs description
- should return the last undescribed event id if there is one
- should return zero if there are no undescribed events

InfoRequest when emailing
- should have a valid incoming email
- should have a sensible incoming name and email
- should have a sensible recipient name and email
- should recognise its own incoming email
- should recognise its own incoming email with some capitalisation
- should recognise its own incoming email with quotes
- should recognise l and 1 as the same in incoming emails
- should recognise old style request-bounce- addresses
- should return nil when receiving email for a deleted request
- should cope with indexing after item is deleted (FAILED - 19)

InfoRequest when calculating the status
- has expected sent date
- has correct due date
- has correct very overdue after date
- isn't overdue on due date (20 working days after request sent)
- is overdue a day after due date (20 working days after request sent)
- is still overdue 40 working days after request sent
- is very overdue the day after 40 working days after request sent

InfoRequest when using a plugin and calculating the status
- rejects invalid states
- accepts core states
- accepts extended states
- is not overdue if it's had the deadline extended

InfoRequest when calculating the status for a school
- has expected sent date
- has correct due date
- has correct very overdue after date
- isn't overdue on due date (20 working days after request sent)
- is overdue a day after due date (20 working days after request sent)
- is still overdue 40 working days after request sent
- is still overdue the day after 40 working days after request sent
- is still overdue 60 working days after request sent
- is very overdue the day after 60 working days after request sent

InfoRequest when asked if a user is the owning user for this request
- should return false if a nil object is passed to it
- should return true if the user is the request's owner
- should return false for a user that is not the owner and does not own every request
- should return true if the user is not the owner but owns every request

InfoRequest when asked if it requires admin
- should return true if its described state is error_message
- should return true if its described state is requires_admin
- should return false if its described state is waiting_response

InfoRequest when asked for old unclassified requests
- should ask for requests using any limit param supplied
- should ask for requests using any offset param supplied
- should not limit the number of requests returned by default
- should add extra conditions if supplied
- should ask the database for requests that are awaiting description, have a last response older
        than 21 days old, have a user, are not the holding pen and are not backpaged

InfoRequest when an instance is asked if it is old and unclassified
- should return false if it is the holding pen
- should return false if it is not awaiting description
- should return false if its last response event occurred less than 21 days ago
- should return true if it is awaiting description, isn't the holding pen and hasn't had an event in 21 days

InfoRequest when applying censor rules when applying censor rules to text
- should apply a global censor rule (FAILED - 20)
- should apply a user rule (FAILED - 21)
- should not raise an error if there is no user (FAILED - 22)
- should apply a rule from the body associated with the request (FAILED - 23)
- should apply a request rule (FAILED - 24)

InfoRequest when applying censor rules when applying censor rules to binary files
- should apply a global censor rule (FAILED - 25)
- should apply a user rule (FAILED - 26)
- should not raise an error if there is no user (FAILED - 27)
- should apply a rule from the body associated with the request (FAILED - 28)
- should apply a request rule (FAILED - 29)

InfoRequest when an instance is asked if all can view it
- should return true if its prominence is normal
- should return true if its prominence is backpage
- should return false if its prominence is hidden
- should return false if its prominence is requester_only

User when indexing users with Xapian
- should search by name (FAILED - 30)
- should search by 'about me' text (FAILED - 31)

PublicBody when indexing public bodies with Xapian
- should search index the main name field (FAILED - 32)
- should search index the notes field (FAILED - 33)
- should delete public bodies from the index when they are destroyed (FAILED - 34)

PublicBody when indexing requests by body they are to
- should find requests to the body (FAILED - 35)
- should update index correctly when URL name of body changes (FAILED - 36)
- should work with URL names that are longer than 64 characters (FAILED - 37)

User when indexing requests by user they are from
- should find requests from the user (FAILED - 38)
- should find just the sent message events from a particular user (FAILED - 39)
- should not find it when one of the request's users is changed (FAILED - 40)
- should not get confused searching for requests when one user has a name which has same stem as another (FAILED - 41)
- should update index correctly when URL name of user changes (FAILED - 42)

User when indexing comments by user they are by
- should find requests from the user (FAILED - 43)
- should update index correctly when URL name of user changes (FAILED - 44)

InfoRequest when indexing requests by their title
- should find events for the request (FAILED - 45)
- should update index correctly when URL title of request changes (FAILED - 46)

InfoRequest when indexing requests by tag
- should find request by tag, even when changes (FAILED - 47)

PublicBody when indexing authorities by tag
- should find request by tag, even when changes (FAILED - 48)

PublicBody when only indexing selected things on a rebuild
- should only index what we ask it to (FAILED - 49)

CensorRule substituting things when using a text rule
- should do basic text substitution
- should keep size same for binary substitution

CensorRule substituting things when using a regular expression rule
- replaces the regexp with the replacement text when applied to text
- replaces the regexp with the same number of 'x' characters as the text replaced
            when applied to binary

when validating rules when validating a regexp rule
- should try to create a regexp from the text

when validating rules when validating a regexp rule if a regexp error is produced
- should add an error message to the text field with the regexp error message

when validating rules when validating a regexp rule if no regexp error is produced
- should not add any error message to the text field

when validating rules when the allow_global flag has been set
- should allow a global censor rule (without user_id, request_id or public_body_id)

when validating rules when the allow_global flag has not been set
- should not allow a global text censor rule (without user_id, request_id or public_body_id)
- should not allow a global regex censor rule (without user_id, request_id or public_body_id)

when handling global rules an instance without user_id, request_id or public_body_id
- should return a value of true from is_global?

when handling global rules the scope CensorRule.global.all
- should include an instance without user_id, request_id or public_body_id
- should not include a request with user_id

OutgoingMailer when working out follow up addresses
- should parse them right
- should work when there is only an email address
- should quote funny characters
- should quote quotes
- should quote @ signs

OutgoingMailer when working out follow up subjects
- should prefix the title with 'Freedom of Information request -' for initial requests
- should use 'Re:' and inital request subject for followups which aren't replies to particular messages
- should prefix with Re: the subject of the message being replied to
- should not add Re: prefix if there already is such a prefix
- should not add Re: prefix if there already is a lower case re: prefix
- should use 'Re:' and initial request subject when replying to failed delivery notifications

HelpController when using help
- shows the about page
- shows contact form
- sends a contact message

RequestController when listing recent requests
- should be successful (FAILED - 50)
- should render with 'list' template (FAILED - 51)
- should filter requests (FAILED - 52)
- should filter requests by date (FAILED - 53)
- should make a sane-sized cache tag (FAILED - 54)
- should vary the cache tag with locale (FAILED - 55)
- should list internal_review requests as unresolved ones (FAILED - 56)
- should assign the first page of results (FAILED - 57)
- should return 404 for pages we don't want to serve up (FAILED - 58)
- should not raise an error for a page param of less than zero, but should treat it as
        a param of 1 (FAILED - 59)

RequestController when changing things that appear on the request page
- should purge the downstream cache when mail is received
- should purge the downstream cache when a comment is added
- should purge the downstream cache when a followup is made
- should purge the downstream cache when the request is categorised
- should purge the downstream cache when the authority data is changed
- should purge the downstream cache when the user name is changed
- should not purge the downstream cache when non-visible user details are changed
- should purge the downstream cache when censor rules have changed
- should purge the downstream cache when something is hidden by an admin
- should not create more than one entry for any given resourcce

RequestController when showing one request
- should be successful
- should render with 'show' template
- should show the request
- should assign the request
- should redirect from a numeric URL to pretty one
- should show actions the request owner can take

RequestController when showing one request when the request does allow comments
- should have a comment link

RequestController when showing one request when the request does not allow comments
- should not have a comment link

RequestController when showing one request when the request is being viewed by an admin if the request is awaiting description
- should show the describe state form
- should ask the user to use the describe state from

RequestController when showing one request when the request is being viewed by an admin if the request is waiting for a response and very overdue
- should give a link to requesting an internal review

RequestController when showing one request when the request is being viewed by an admin if the request is waiting clarification
- should give a link to make a followup

RequestController when showing one request when showing an external request when viewing with no logged in user
- should be successful
- should not display actions the request owner can take

RequestController when showing one request when showing an external request when the request is being viewed by an admin
- should be successful

RequestController when showing one request when showing an external request when the request is being viewed by an admin if the request is awaiting description
- should not show the describe state form
- should not ask the user to use the describe state form

RequestController when showing one request when showing an external request when the request is being viewed by an admin if the request is waiting for a response and very overdue
- should not give a link to requesting an internal review

RequestController when showing one request when showing an external request when the request is being viewed by an admin if the request is waiting clarification
- should not give a link to make a followup
- should not give a link to sign in (in the request status paragraph)

RequestController when showing one request when handling an update_status parameter
- should assign the "update status" flag to the view as true if the parameter is present
- should assign the "update status" flag to the view as false if the parameter is not present
- should require login
- should work if logged in as the requester
- should not work if logged in as not the requester
- should work if logged in as an admin user

RequestController when showing one request when handling an update_status parameter when the request is external
- should assign the "update status" flag to the view as false if the parameter is present
- should assign the "update status" flag to the view as false if the parameter is not present

RequestController when showing one request when handling incoming mail
- should receive incoming messages, send email to creator, and show them
- should download attachments
- should cache an attachment on a request with normal prominence
- should convert message body to UTF8 (FAILED - 60)
- should generate valid HTML verson of plain text attachments
- should return 404 for ugly URLs containing a request id that isn't an integer
- should return 404 when incoming message and request ids don't match
- should return 404 for ugly URLs contain a request id that isn't an integer, even if the integer prefix refers to an actual request
- should return 404 when incoming message and request ids don't match
- should generate valid HTML verson of PDF attachments (FAILED - 61)
- should not cause a reparsing of the raw email, even when the result would be a 404
- should treat attachments with unknown extensions as binary
- should not download attachments with wrong file name
- should censor attachments downloaded as binary
- should censor with rules on the user (rather than the request)
- should censor attachment names

RequestController when showing one request when handling incoming mail when making a zipfile available
- should have a different zipfile URL when the request changes
- should successfully make a zipfile for an external request

RequestController when changing prominence of a request
- should not show hidden requests
- should not show hidden requests even if logged in as their owner
- should show hidden requests if logged in as super user
- should not show requester_only requests if you're not logged in
- should show requester_only requests to requester and admin if logged in
- should not cache an attachment on a request whose prominence is requester_only when showing
        the request to the requester or admin
- should not download attachments if hidden

RequestController when searching for an authority
- should return nothing for the empty query string
- should return matching bodies (FAILED - 62)
- should not give an error when user users unintended search operators

RequestController when creating a new request
- should redirect to front page if no public body specified
- should redirect to front page if no public body specified, when logged in
- should redirect 'bad request' page when a body has no email address
- should accept a public body parameter
- should give an error and render 'new' template when a summary isn't given
- should redirect to sign in page when input is good and nobody is logged in
- should show preview when input is good
- should allow re-editing of a request
- should create the request and outgoing message, and send the outgoing message by email, and redirect to request page when input is good and somebody is logged in
- should give an error if the same request is submitted twice
- should let you submit another request with the same title
- should respect the rate limit
- should ignore the rate limit for specified users

RequestController when making a new request
- should allow you to have one undescribed request
- should fail if more than one request undescribed
- should allow you if more than one request undescribed but are allowed to leave requests undescribed
- should fail if user is banned

RequestController when viewing an individual response for reply/followup
- should ask for login if you are logged in as wrong person
- should show the response if you are logged in as right person
- should offer the opportunity to reply to the main address
- should offer an opportunity to reply to another address
- should not show individual responses if request hidden, even if request owner

RequestController when viewing an individual response for reply/followup when viewing a response for an external request
- should show a message saying that external requests cannot be followed up
- should be successful

RequestController when classifying an information request if the request is external
- should redirect to the request page

RequestController when classifying an information request when the request is internal
- should require login
- should ask whether the request is old and unclassified
- should not classify the request if logged in as the wrong user

RequestController when classifying an information request when the request is internal when the request is old and unclassified when the user is not logged in
- should require login

RequestController when classifying an information request when the request is internal when the request is old and unclassified when the user is logged in as a different user
- should classify the request
- should log a status update event
- should send an email to the requester letting them know someone has updated the status of their request
- should redirect to the request page
- should show a message thanking the user for a good deed

RequestController when classifying an information request when the request is internal when logged in as an admin user who is not the actual requester
- should update the status of the request
- should log a status update event
- should record a classification
- should send an email to the requester letting them know someone has updated the status of their request
- should redirect to the request page
- should show a message thanking the user for a good deed

RequestController when classifying an information request when the request is internal when logged in as an admin user who is also the actual requester
- should update the status of the request
- should not log a status update event
- should not send an email to the requester letting them know someone has updated the status of their request
- should say it is showing advice as to what to do next
- should redirect to the unhappy page

RequestController when classifying an information request when the request is internal when logged in as the requestor
- should successfully classify response if logged in as user controlling request
- should not log a status update event
- should not send an email to the requester letting them know someone has updated the status of their request
- should send email when classified as requires_admin
- should say it is showing advice as to what to do next
- should redirect to the unhappy page
- knows about extended states

RequestController when classifying an information request when the request is internal when redirecting after a successful status update by the request owner
- should redirect to the "request url" with a message in the right tense when status is updated to "waiting response" and the response is not overdue
- should redirect to the "request url" with a message in the right tense when status is updated to "waiting response" and the response is overdue
- should redirect to the "request url" with a message in the right tense when status is updated to "waiting response" and the response is overdue
- should redirect to the "request url" when status is updated to "not held"
- should redirect to the "request url" when status is updated to "successful"
- should redirect to the "unhappy url" when status is updated to "rejected"
- should redirect to the "unhappy url" when status is updated to "partially successful"
- should redirect to the "response url" when status is updated to "waiting clarification" and there is a last response
- should redirect to the "response no followup url" when status is updated to "waiting clarification" and there are no events needing description
- should redirect to the "respond to last url" when status is updated to "gone postal"
- should redirect to the "request url" when status is updated to "internal review"
- should redirect to the "help general url" when status is updated to "requires admin"
- should redirect to the "help general url" when status is updated to "error message"
- should redirect to the "respond to last url url" when status is updated to "user_withdrawn"

RequestController when sending a followup message
- should require login
- should not let you if you are logged in as the wrong user
- should give an error and render 'show_response' template when a body isn't given
- should show preview when input is good
- should allow re-editing of a preview
- should send the follow up message if you are the right user
- should give an error if the same followup is submitted twice

RequestController sending overdue request alerts
- should send an overdue alert mail to creators of overdue requests
- should include clause for schools when sending an overdue alert mail to creators of overdue requests
- should send not actually send the overdue alert if the user is banned but should
        record it as sent
- should send a very overdue alert mail to creators of very overdue requests
- should not resend alerts to people who've already received them
- should send alerts for requests where the last event forming the initial request is a followup
        being sent following a request for clarification

RequestController sending unclassified new response reminder alerts
- should send an alert

RequestController clarification required alerts
- should send an alert
- should not send an alert if you are banned

RequestController comment alerts
- should send an alert (once and once only)
- should not send an alert when you comment on your own request
- should not send an alert for a comment on an external request
- should send an alert when there are two new comments

RequestController when viewing comments
- should link to the user who submitted it
- should link to the user who submitted to it, even if it is you

RequestController authority uploads a response from the web interface
- should require login to view the form to upload
- should let you view upload form if you are an FOI officer
- should prevent uploads if you are not a requester
- should prevent entirely blank uploads
- should 404 for non existent requests
- should let the authority upload a file (FAILED - 63)

RequestController when showing JSON version for API
- should return data in JSON form

RequestController when doing type ahead searches
- should return nothing for the empty query string
- should return a request matching the given keyword, but not users with a matching description (FAILED - 64)
- should return all requests matching any of the given keywords (FAILED - 65)
- should not return matches for short words
- should do partial matches for longer words (FAILED - 66)
- should not give an error when user users unintended search operators
- should return all requests matching any of the given keywords (FAILED - 67)

RequestController when showing similar requests
- should work
- should show similar requests (FAILED - 68)
- should 404 for non-existent paths

RequestController when reporting a request when not logged in
- should only allow logged-in users to report requests

RequestController when reporting a request (logged in)
- should 404 for non-existent requests
- should mark a request as having been reported
- should not allow a request to be reported twice
- should let users know a request has been reported
- should send an email from the reporter to admins

AdminCensorRuleController when making censor rules from the admin interface
- should create a censor rule and purge the corresponding request from varnish

UserController when showing a user
- should be successful (FAILED - 69)
- should redirect to lower case name if given one with capital letters (FAILED - 70)
- should render with 'show' template (FAILED - 71)
- should distinguish between 'my profile' and 'my requests' for logged in users (FAILED - 72)
- should assign the user (FAILED - 73)
- should search the user's contributions (FAILED - 74)
- should not show unconfirmed users (FAILED - 75)

UserController when signing in
- should show sign in / sign up page
- should create post redirect to / when you just go to /signin
- should create post redirect to /list when you click signin on /list
- should show you the sign in page again if you get the password wrong
- should log in when you give right email/password, and redirect to where you were
- should not log you in if you use an invalid PostRedirect token, and shouldn't give 500 error either
- should ask you to confirm your email if it isn't confirmed, after log in
- should confirm your email, log you in and redirect you to where you were after you click an email link
- should keep you logged in if you click a confirmation link and are already logged in as an admin

UserController when signing up
- should be an error if you type the password differently each time
- should be an error to sign up with a misformatted email
- should send confirmation mail if you fill in the form right
- should send confirmation mail in other languages or different locales
- should send special 'already signed up' mail if you fill the form in with existing registered email

UserController when signing out
- should log you out and redirect to the home page
- should log you out and redirect you to where you were

UserController when sending another user a message
- should redirect to signin page if you go to the contact form and aren't signed in
- should show contact form if you are signed in
- should give error if you don't fill in the subject
- should send the message

UserController when changing password
- should show the email form when not logged in
- should send a confirmation email when logged in normally
- should send a confirmation email when have wrong login circumstance
- should show the password change screen when logged in as special password change mode
- should change the password, if you have right to do so
- should not change the password, if you're not logged in
- should not change the password, if you're just logged in normally

UserController when changing email address
- should require login
- should show form for changing email if logged in
- should be an error if the password is wrong, everything else right
- should be an error if old email is wrong, everything else right
- should work even if the old email had a case difference
- should send confirmation email if you get all the details right
- should send special 'already signed up' mail if you try to change your email to one already used

UserController when using profile photos
- should not let you change profile photo if you're not logged in as the user
- should return a 404 not a 500 when a profile photo has not been set
- should let you change profile photo if you're logged in as the user
- should let you change profile photo twice

UserController when showing JSON version for API
- should be successful

UserController when viewing the wall
- should show users stuff on their wall, most recent first (FAILED - 76)
- should show other users' activities on their walls (FAILED - 77)
- should allow users to turn their own email alerts on and off (FAILED - 78)

AdminPublicBodyController when administering public bodies
- shows the index page
- searches for 'humpa'
- shows a public body
- creates a new public body
- edits a public body
- saves edits to a public body
- does not destroy a public body that has associated requests
- destroys a public body
- sets a using_admin flag
- mass assigns tags

AdminPublicBodyController when administering public bodies import_csv when handling a GET request
- should get the page successfully

AdminPublicBodyController when administering public bodies import_csv when handling a POST request
- should handle a nil csv file param

AdminPublicBodyController when administering public bodies import_csv when handling a POST request if there is a csv file param
- should try to get the contents and original name of a csv file param
- should assign the original filename to the view

AdminPublicBodyController when administering public bodies import_csv when handling a POST requestif there is no csv file param, but there are temporary_csv_file and
                      original_csv_file params
- should try and get the file contents from a temporary file whose name
                    is passed as a param
- should raise an error on an invalid temp file name
- should raise an error if the temp file does not exist
- should assign the temporary filename to the view

AdminPublicBodyController when administering public bodies and paying attention to authentication
- disallows non-authenticated users to do anything
- skips admin authorisation when SKIP_ADMIN_AUTH set
- doesn't let people with bad credentials log in
- allows people with good credentials log in using HTTP Basic Auth
- allows superusers to do stuff
- doesn't allow non-superusers to do stuff

AdminPublicBodyController when administering public bodies with i18n
- shows the index page
- searches for 'humpa'
- shows a public body
- edits a public body
- saves edits to a public body
- destroy a public body

AdminPublicBodyController when creating public bodies with i18n
- creates a new public body in one locale
- creates a new public body with multiple locales

TrackController when making a new track on a request
- should require login when making new track
- should save a request track and redirect if you are logged in
- should 404 for non-existent requests
- should save a search track and redirect to the right place

TrackController when sending alerts for a track
- should send alerts (FAILED - 79)
- should send localised alerts (FAILED - 80)

TrackController when viewing RSS feed for a track
- should get the RSS feed (FAILED - 81)
- should return NotFound for a non-existent user (FAILED - 82)

TrackController when viewing JSON version of a track feed
- should get the feed (FAILED - 83)

TrackController when tracking a public body
- should work (FAILED - 84)
- should filter by event type (FAILED - 85)

RequestGameController when playing the game
- should show the game homepage

AdminGeneralController when viewing front page of admin interface
- should render the front page
- should redirect to include trailing slash

AdminGeneralController when viewing the timeline
- should assign an array of events in order of descending date to the view

AdminUserController when administering users
- shows the index/list page
- searches for 'bob'
- shows a user
- logs in as another user

ApiController when using the API
- should check the API key
- should create a new request from a POST
- should add a response to a request
- should add a followup to a request
- should not allow internal requests to be updated
- should not allow other people's requests to be updated
- should not allow files to be attached to a followup
- should allow files to be attached to a response (FAILED - 86)
- should show information about a request
- should show an Atom feed of new request events
- should show a JSON feed of new request events
- should honour the since_event_id parameter
- should honour the since_date parameter for the Atom feed
- should return a JSON 404 error for non-existent requests
- should return a JSON 500 error if we try to add correspondence to a request we don't own

GeneralController when trying to show the blog
- should fail silently if the blog is returning an error

GeneralController when getting the blog feed
- should add a lang param correctly to a url with no querystring
- should add a lang param correctly to a url with an existing querystring

GeneralController when searching
- should render the front page successfully (FAILED - 87)
- should render the front page with default language (FAILED - 88)
- should render the front page with default language (FAILED - 89)
- should render the front page with default language and ignore the browser setting (FAILED - 90)
- should render the front page with browser-selected language when there's no default set (FAILED - 91)
- doesn't raise an error when there's no user matching the one in the session (FAILED - 92)
- should redirect from search query URL to pretty URL (FAILED - 93)
- should filter results based on end of URL being 'all' (FAILED - 94)
- should filter results based on end of URL being 'users' (FAILED - 95)
- should filter results based on end of URL being 'requests' (FAILED - 96)
- should filter results based on end of URL being 'bodies' (FAILED - 97)
- should show help when searching for nothing (FAILED - 98)
- should not show unconfirmed users (FAILED - 99)
- should show newly-confirmed users (FAILED - 100)
- should show tracking links for requests-only searches (FAILED - 101)

GeneralController when searching when using different locale settings
- should generate URLs with a locale prepended when there's more than one locale set (FAILED - 102)
- should use our test PO files rather than the application one (FAILED - 103)
- should generate URLs that include the locale when using one that includes an underscore (FAILED - 104)
- should fall back to the language if the territory is unknown (FAILED - 105)
- should generate URLs without a locale prepended when there's only one locale set (FAILED - 106)

GeneralController when searching when constructing the list of recent requests
- should list the newest successful request first (FAILED - 107)
- should coalesce duplicate requests (FAILED - 108)

GeneralController when searching when using xapian search
- should find info request when searching for '"fancy dog"' (FAILED - 109)
- should find public body and incoming message when searching for 'geraldine quango' (FAILED - 110)

PublicBodyController when showing a body
- should be successful (FAILED - 111)
- should render with 'show' template (FAILED - 112)
- should assign the body (FAILED - 113)
- should assign the requests (1) (FAILED - 114)
- should assign the requests (2) (FAILED - 115)
- should assign the requests (3) (FAILED - 116)
- should assign the body using different locale from that used for url_name (FAILED - 117)
- should assign the body using same locale as that used in url_name (FAILED - 118)
- should redirect use to the relevant locale even when url_name is for a different locale (FAILED - 119)
- should redirect to newest name if you use historic name of public body in URL (FAILED - 120)
- should redirect to lower case name if you use mixed case name in URL (FAILED - 121)

PublicBodyController when listing bodies
- should be successful
- should list all bodies from default locale, even when there are no translations for selected locale
- should list bodies in alphabetical order
- should support simple searching of bodies by title
- should support simple searching of bodies by notes
- should list bodies in alphabetical order with different locale
- should list a tagged thing on the appropriate list page, and others on the other page, and all still on the all page
- should list a machine tagged thing, should get it in both ways

PublicBodyController when showing JSON version for API
- should be successful

PublicBodyController when doing type ahead searches
- should return nothing for the empty query string (FAILED - 122)
- should return a body matching the given keyword, but not users with a matching description (FAILED - 123)
- should return all requests matching any of the given keywords (FAILED - 124)
- should return requests matching the given keywords in any of their locales (FAILED - 125)
- should not return  matches for short words (FAILED - 126)

ServicesController when using web services
- should show no alaveteli message when in the deployed country
- should show an alaveteli message when not in the deployed country and in a country with no FOI website
- should show link to other FOI website when not in the deployed country

AdminTrackController when administering tracks
- shows the list page

CommentController when commenting on a request
- should give an error and render 'new' template when body text is just some whitespace
- should show preview when input is good
- should redirect to sign in page when input is good and nobody is logged in
- should create the comment, and redirect to request page when input is good and somebody is logged in
- should give an error if the same request is submitted twice
- should not allow comments if comments are not allowed

CommentController when commenting on a request when commenting on an external request when responding to a GET request on a successful request
- should be successful

AdminRequestController when administering requests
- shows the index/list page
- shows a public body
- shows an external public body with no username
- edits a public body
- saves edits to a request
- expires the request cache when saving edits to it
- edits an outgoing message
- saves edits to an outgoing_message

AdminRequestController when administering requests when fully destroying a request
- expires the file cache for that request

AdminRequestController when administering the holding pen
- shows a rejection reason for an incoming message from an invalid address
- allows redelivery even to a closed request
- allows redelivery to more than one request
- expires the file cache for the previous request
- guesses a misdirected request
- shows a suitable default 'your email has been hidden' message

AdminRequestController when administering the holding pen when destroying an incoming message
- destroys the raw email file
- asks the incoming message to fully destroy itself
- expires the file cache for the associated info_request

AdminRequestController when administering the holding pen when hiding requests
- hides requests and sends a notification email that it has done so
- expires the file cache for the request

AdminRequestController when administering the holding pen when hiding requests when hiding an external request
- should redirect the the admin page for the request
- should set the request prominence to "requester_only"
- should not send a notification email
- should add a notice to the flash saying that the request has been hidden
- should expire the file cache for the request

ApplicationController when accessing third party services
- should succeed if the service responds OK
- should fail silently if the country_from_ip domain doesn't exist
- should fail silently if the country_from_ip service doesn't exist
- should fail silently if the country_from_ip service returns an error

ApplicationController when caching fragments
- should not fail with long filenames (FAILED - 127)

When filtering
- should not fail when not in test mode (FAILED - 128)
- should detect an Exim bounce
- should detect a WebShield delivery error message
- should detect a MS Exchange non-permanent delivery error message
- should pass on a non-bounce message
- should detect a multipart bounce
- should detect a generic out-of-office
- should detect an Exchange-style out-of-office
- should detect a Lotus Domino-style out-of-office
- should detect a Messagelabs-style out-of-office
- should detect an out-of-office that has an X-POST-MessageClass header
- should detect an Outlook(?)-style out-of-office
- should detect an ABCMail-style out-of-office

when viewing the request game
- should show the correct url for a request

when displaying actions that can be taken with regard to a request
- should display a link for the request owner to request a review

when displaying actions that can be taken with regard to a request if the request is old and unclassified
- should not display a link for the request owner to update the status of the request
- should display a link for anyone to update the status of the request

when displaying actions that can be taken with regard to a request if the request is not old and unclassified
- should display a link for the request owner to update the status of the request
- should not display a link for anyone to update the status of the request

when viewing an information request
- should show the sidebar
- should show the actions people can take

when viewing an information request when a status update has been requested
- should show the first form for describing the state of the request

when viewing an information request when it is awaiting a description
- should show the first form for describing the state of the request
- should show the second form for describing the state of the request

when viewing an information request when the user is the request owner when the request status is "waiting clarification" when there is a last response
- should show a link to follow up the last response with clarification

when viewing an information request when the user is the request owner when the request status is "waiting clarification" when there is no last response
- should show a link to follow up the request without reference to a specific response

when listing recent requests
- should be successful
- should cope with no results

when showing the form for describing the state of a request if the user is a regular user (not the request owner) if the request is not old and unclassified
- should not show the form
- should give a link to login

when showing the form for describing the state of a request if the user is a regular user (not the request owner) if the request is old and unclassified
- should not show the form
- should show the form for someone else to classify the request
- should not give a link to login

when showing the form for describing the state of a request if showing the form to the user owning the request
- should show a radio button to set the status to "gone postal"
- should show a radio button to set the status to "not held"
- should show a radio button to set the status to "partially successful"
- should show a radio button to set the status to "successful"
- should show a radio button to set the status to "rejected"
- should show a radio button to set the status to "error_message"
- should not show a radio button to set the status to "requires_admin"
- should not show a radio button to set the status to "user_withdrawn"

when showing the form for describing the state of a request if showing the form to the user owning the request when the request is not in internal review
- should show a radio button to set the status to "waiting response"
- should show a radio button to set the status to "waiting clarification"
- should not show a radio button to set the status to "internal_review"

when showing the form for describing the state of a request if showing the form to the user owning the request when the user has asked to update the status of the request
- should show a radio button to set the status to "internal_review"
- should show a radio button to set the status to "requires_admin"
- should show a radio button to set the status to "user_withdrawn"

when showing the form for describing the state of a request if showing the form to the user owning the request when the request is in internal review
- should show a radio button to set the status to "internal review"
- should show the text "The review has finished and overall:"

when viewing a body
- should be successful
- should be valid HTML (FAILED - 129)
- should show the body's name
- should tell total number of requests
- should cope with no results
- should cope with Xapian being down
- should link to Charity Commission site if we have numbers to do so
- should link to Scottish Charity Regulator site if we have an SC number
- should not link to Charity Commission site if we don't have number

When viewing requests
- should not make endlessly recursive JSON <link>s

When searching
- should not strip quotes from quoted query (FAILED - 130)
- should redirect requests with search in query string to URL-based page (FAILED - 131)
- should correctly execute simple search (FAILED - 132)
- should correctly filter searches for requests (FAILED - 133)
- should correctly filter searches for users (FAILED - 134)
- should correctly filter searches for successful requests (FAILED - 135)
- should correctly filter searches for comments (FAILED - 136)

When administering the site
- allows an admin to log in as another user

When creating requests
- should associate the request with the requestor, even if it is approved by an admin

When rendering errors
- should render a 404 for unrouteable URLs
- should render a 404 for users that don't exist (FAILED - 137)
- should render a 404 for bodies that don't exist (FAILED - 138)
- should render a 500 for general errors
- should render a 403 for attempts at directory listing for attachments (FAILED - 139)
- should render a 404 for non-existent 'details' pages for requests (FAILED - 140)

when using TMail
- should load an email with funny MIME settings (FAILED - 141)
- should parse multiple to addresses with unqoted display names
- should convert to utf8 (FAILED - 142)

when sending email with an altered return path
- should default to delivery method test
- should let the helper change the method
- should set the return path when sending email using SMTP
- should set the return path when sending email using sendmail

when doing things with timezones
- should preserve time objects with local time conversion to default timezone UTC
      and return them as UTC times when config.time_zone is UTC
- should preserve time objects with time with zone conversion to default timezone UTC
      and return them as local times in the zone set by Time.use_zone
- should preserve time objects with UTC time conversion to default timezone local
      and return then as UTC times when config.time_zone is UTC
- should preserve time objects with time with zone conversion to default timezone local
      and return them as local times in the zone set by Time.use_zone

WhatDoTheyKnow::StripEmptySessions
- should not prevent a cookie being set if there is data in the session

WhatDoTheyKnow::StripEmptySessions if there is no meaningful data in the session
- should not strip any other header
- should strip the session cookie setting header 
- should strip the session cookie setting header even with a locale
- should not strip the session cookie setting for admins
- should strip the session cookie setting header (but no other cookie setting header) if there is more than one

PublicBodyCategories when asked for categories with headings
- should return a list of headings as plain strings, each followed by n tag specifications as
            lists in the form:
            ["tag_to_use_as_category", "Sub category title", "Instance description"]

PublicBodyCategories when asked for headings
- should return a list of headings

PublicBodyCategories when asked for tags by headings
- should return a hash of tags keyed by heading

1)
Encoding::CompatibilityError in 'IncomingMessage when dealing with incoming mail should correctly fold various types of footer'
incompatible encoding regexp match (Windows-31J regexp with UTF-8 string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:396:in `gsub!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:396:in `remove_quoted_sections'
spec/models/incoming_message_spec.rb:37:in `block (3 levels) in <top (required)>'
spec/models/incoming_message_spec.rb:35:in `each'
spec/models/incoming_message_spec.rb:35:in `block (2 levels) in <top (required)>'

2)
Encoding::CompatibilityError in 'IncomingMessage when dealing with incoming mail should ensure cached body text has been parsed correctly'
incompatible encoding regexp match (Windows-31J regexp with UTF-8 string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:706:in `scan'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:706:in `_uudecode_and_save_attachments'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:806:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:603:in `get_main_body_text_internal'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:564:in `_cache_main_body_text'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:597:in `get_main_body_text_unfolded'
spec/models/incoming_message_spec.rb:47:in `block (2 levels) in <top (required)>'

3)
Encoding::CompatibilityError in 'IncomingMessage when dealing with incoming mail should correctly convert HTML even when there's a meta tag asserting that it is iso-8859-1 which would normally confuse elinks'
incompatible encoding regexp match (Windows-31J regexp with UTF-8 string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:706:in `scan'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:706:in `_uudecode_and_save_attachments'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:806:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
spec/models/incoming_message_spec.rb:54:in `block (2 levels) in <top (required)>'

4)
Encoding::CompatibilityError in 'IncomingMessage when dealing with incoming mail should unquote RFC 2047 headers'
incompatible encoding regexp match (Windows-31J regexp with UTF-8 string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:706:in `scan'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:706:in `_uudecode_and_save_attachments'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:806:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:172:in `mail_from'
spec/models/incoming_message_spec.rb:63:in `block (2 levels) in <top (required)>'

5)
TypeError in 'IncomingMessage when dealing with incoming mail should not error on display of a message which has no charset set on the body part and
        is not good utf-8'
can't convert String into Integer
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionmailer-2.3.14/lib/action_mailer/vendor/tmail-1.2.7/tmail/vendor/rchardet-1.3/lib/rchardet/codingstatemachine.rb:45:in `[]'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionmailer-2.3.14/lib/action_mailer/vendor/tmail-1.2.7/tmail/vendor/rchardet-1.3/lib/rchardet/codingstatemachine.rb:45:in `next_state'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionmailer-2.3.14/lib/action_mailer/vendor/tmail-1.2.7/tmail/vendor/rchardet-1.3/lib/rchardet/utf8prober.rb:52:in `block in feed'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionmailer-2.3.14/lib/action_mailer/vendor/tmail-1.2.7/tmail/vendor/rchardet-1.3/lib/rchardet/utf8prober.rb:50:in `each_byte'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionmailer-2.3.14/lib/action_mailer/vendor/tmail-1.2.7/tmail/vendor/rchardet-1.3/lib/rchardet/utf8prober.rb:50:in `feed'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionmailer-2.3.14/lib/action_mailer/vendor/tmail-1.2.7/tmail/vendor/rchardet-1.3/lib/rchardet/charsetgroupprober.rb:66:in `block in feed'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionmailer-2.3.14/lib/action_mailer/vendor/tmail-1.2.7/tmail/vendor/rchardet-1.3/lib/rchardet/charsetgroupprober.rb:63:in `each'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionmailer-2.3.14/lib/action_mailer/vendor/tmail-1.2.7/tmail/vendor/rchardet-1.3/lib/rchardet/charsetgroupprober.rb:63:in `feed'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionmailer-2.3.14/lib/action_mailer/vendor/tmail-1.2.7/tmail/vendor/rchardet-1.3/lib/rchardet/universaldetector.rb:124:in `block in feed'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionmailer-2.3.14/lib/action_mailer/vendor/tmail-1.2.7/tmail/vendor/rchardet-1.3/lib/rchardet/universaldetector.rb:123:in `each'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionmailer-2.3.14/lib/action_mailer/vendor/tmail-1.2.7/tmail/vendor/rchardet-1.3/lib/rchardet/universaldetector.rb:123:in `feed'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionmailer-2.3.14/lib/action_mailer/vendor/tmail-1.2.7/tmail/vendor/rchardet-1.3/lib/rchardet.rb:63:in `detect'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionmailer-2.3.14/lib/action_mailer/vendor/tmail-1.2.7/tmail/quoting.rb:108:in `convert_to_with_fallback_on_iso_8859_1'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionmailer-2.3.14/lib/action_mailer/vendor/tmail-1.2.7/tmail/quoting.rb:134:in `unquote_base64_and_convert_to'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionmailer-2.3.14/lib/action_mailer/vendor/tmail-1.2.7/tmail/quoting.rb:25:in `unquoted_body'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionmailer-2.3.14/lib/action_mailer/vendor/tmail-1.2.7/tmail/quoting.rb:54:in `body'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionmailer-2.3.14/lib/action_mailer/vendor/tmail-1.2.7/tmail/interface.rb:1031:in `base64_decode'
/home/mdupont/experiments/alaveteli/app/models/request_mailer.rb:215:in `receive'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:89:in `receive_incoming_mail'
spec/models/incoming_message_spec.rb:70:in `block (2 levels) in <top (required)>'

6)
RuntimeError in 'IncomingMessage when parsing HTML mail should display UTF-8 characters in the plain text version correctly'
Could not find elinks in any of /usr/bin, /usr/local/bin
/home/mdupont/experiments/alaveteli/lib/alaveteli_external_command.rb:25:in `run'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:926:in `_get_attachment_text_internal_one_file'
spec/models/incoming_message_spec.rb:93:in `block (2 levels) in <top (required)>'

7)
Encoding::CompatibilityError in 'IncomingMessage folding quoted parts of emails should fold an example lotus notes quoted part converted from HTML correctly'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:706:in `scan'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:706:in `_uudecode_and_save_attachments'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:806:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:603:in `get_main_body_text_internal'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:564:in `_cache_main_body_text'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:591:in `get_main_body_text_folded'
spec/models/incoming_message_spec.rb:139:in `block (2 levels) in <top (required)>'

8)
RuntimeError in 'IncomingMessage folding quoted parts of emails should fold an example of another kind of forward quoting'
Could not find elinks in any of /usr/bin, /usr/local/bin
/home/mdupont/experiments/alaveteli/lib/alaveteli_external_command.rb:25:in `run'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:926:in `_get_attachment_text_internal_one_file'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:632:in `_convert_part_body_to_text'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:605:in `get_main_body_text_internal'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:564:in `_cache_main_body_text'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:591:in `get_main_body_text_folded'
spec/models/incoming_message_spec.rb:161:in `block (2 levels) in <top (required)>'

9)
RuntimeError in 'IncomingMessage folding quoted parts of emails should fold a further example of forward quoting'
Could not find elinks in any of /usr/bin, /usr/local/bin
/home/mdupont/experiments/alaveteli/lib/alaveteli_external_command.rb:25:in `run'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:926:in `_get_attachment_text_internal_one_file'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:632:in `_convert_part_body_to_text'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:605:in `get_main_body_text_internal'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:564:in `_cache_main_body_text'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:591:in `get_main_body_text_folded'
spec/models/incoming_message_spec.rb:168:in `block (2 levels) in <top (required)>'

10)
RuntimeError in 'IncomingMessage when censoring data should replace everything in PDF files using pdftk'
Could not find pdftk in any of /usr/bin, /usr/local/bin
/home/mdupont/experiments/alaveteli/lib/alaveteli_external_command.rb:25:in `run'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:269:in `binary_mask_stuff!'
spec/models/incoming_message_spec.rb:326:in `pdf_replacement_test'
spec/models/incoming_message_spec.rb:335:in `block (2 levels) in <top (required)>'

11)
RuntimeError in 'IncomingMessage when censoring data should replace everything in PDF files using ghostscript'
Could not find pdftk in any of /usr/bin, /usr/local/bin
/home/mdupont/experiments/alaveteli/lib/alaveteli_external_command.rb:25:in `run'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:269:in `binary_mask_stuff!'
spec/models/incoming_message_spec.rb:326:in `pdf_replacement_test'
spec/models/incoming_message_spec.rb:339:in `block (2 levels) in <top (required)>'

12)
RuntimeError in 'IncomingMessage when censoring data should not produce zero length output if pdftk silently fails'
Could not find pdftk in any of /usr/bin, /usr/local/bin
/home/mdupont/experiments/alaveteli/lib/alaveteli_external_command.rb:25:in `run'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:269:in `binary_mask_stuff!'
spec/models/incoming_message_spec.rb:345:in `block (2 levels) in <top (required)>'

13)
'IncomingMessage when TNEF attachments are attached to messages should flatten all the attachments out' FAILED
expected: ["FOI 09 02976i.doc", "FOI 09 02976iii.doc"],
     got: ["attachment.bin"] (using ==)
spec/models/incoming_message_spec.rb:509:in `block (2 levels) in <top (required)>'

14)
Encoding::CompatibilityError in 'InfoRequestEvent doing search/index stuff should get search text for outgoing messages'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
spec/models/info_request_event_spec.rb:61:in `block (3 levels) in <top (required)>'

15)
Encoding::CompatibilityError in 'InfoRequestEvent doing search/index stuff should get search text for incoming messages'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
spec/models/info_request_event_spec.rb:61:in `block (3 levels) in <top (required)>'

16)
Encoding::CompatibilityError in 'InfoRequestEvent doing search/index stuff should get clipped text for incoming messages, and cache it too'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
spec/models/info_request_event_spec.rb:61:in `block (3 levels) in <top (required)>'

17)
'ApplicationMailer when using plugins when a plugin prepends its mail templates to the view paths should raise an error if the template is in neither core nor theme' FAILED
expected Exception with "Missing template application_mailer/neither.erb in view path spec/fixtures/theme_views/theme_one:spec/fixtures/theme_views/core", got #<ActionView::MissingTemplate: Missing template application_mailer/neither.erb in view path /home/mdupont/experiments/alaveteli/spec/fixtures/theme_views/theme_one:/home/mdupont/experiments/alaveteli/spec/fixtures/theme_views/core>
spec/models/application_mailer_spec.rb:83:in `block (4 levels) in <top (required)>'

18)
'ApplicationMailer when using plugins when a plugin appends its mail templates to the view paths should raise an error if the template is in neither core nor theme' FAILED
expected Exception with "Missing template application_mailer/neither.erb in view path spec/fixtures/theme_views/core:spec/fixtures/theme_views/theme_one", got #<ActionView::MissingTemplate: Missing template application_mailer/neither.erb in view path /home/mdupont/experiments/alaveteli/spec/fixtures/theme_views/core:/home/mdupont/experiments/alaveteli/spec/fixtures/theme_views/theme_one>
spec/models/application_mailer_spec.rb:128:in `block (4 levels) in <top (required)>'

19)
Encoding::CompatibilityError in 'InfoRequest when emailing should cope with indexing after item is deleted'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
spec/models/info_request_spec.rb:143:in `block (4 levels) in <top (required)>'
spec/models/info_request_spec.rb:143:in `each'
spec/models/info_request_spec.rb:143:in `block (3 levels) in <top (required)>'

20)
Spec::Mocks::MockExpectationError in 'InfoRequest when applying censor rules when applying censor rules to text should apply a global censor rule'
Mock "CensorRule_1133" received unexpected message :to_ary with (no args)
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1038:in `flatten'
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1038:in `applicable_censor_rules'
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1043:in `apply_censor_rules_to_text!'
spec/models/info_request_spec.rb:468:in `block (4 levels) in <top (required)>'

21)
Spec::Mocks::MockExpectationError in 'InfoRequest when applying censor rules when applying censor rules to text should apply a user rule'
Mock "CensorRule_1139" received unexpected message :to_ary with (no args)
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1038:in `flatten'
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1038:in `applicable_censor_rules'
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1043:in `apply_censor_rules_to_text!'
spec/models/info_request_spec.rb:473:in `block (4 levels) in <top (required)>'

22)
'InfoRequest when applying censor rules when applying censor rules to text should not raise an error if there is no user' FAILED
expected no Exception, got #<Spec::Mocks::MockExpectationError: Mock "CensorRule_1145" received unexpected message :to_ary with (no args)>
spec/models/info_request_spec.rb:478:in `block (4 levels) in <top (required)>'

23)
Spec::Mocks::MockExpectationError in 'InfoRequest when applying censor rules when applying censor rules to text should apply a rule from the body associated with the request'
Mock "CensorRule_1151" received unexpected message :to_ary with (no args)
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1038:in `flatten'
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1038:in `applicable_censor_rules'
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1043:in `apply_censor_rules_to_text!'
spec/models/info_request_spec.rb:483:in `block (4 levels) in <top (required)>'

24)
Spec::Mocks::MockExpectationError in 'InfoRequest when applying censor rules when applying censor rules to text should apply a request rule'
Mock "CensorRule_1157" received unexpected message :to_ary with (no args)
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1038:in `flatten'
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1038:in `applicable_censor_rules'
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1043:in `apply_censor_rules_to_text!'
spec/models/info_request_spec.rb:488:in `block (4 levels) in <top (required)>'

25)
Spec::Mocks::MockExpectationError in 'InfoRequest when applying censor rules when applying censor rules to binary files should apply a global censor rule'
Mock "CensorRule_1163" received unexpected message :to_ary with (no args)
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1038:in `flatten'
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1038:in `applicable_censor_rules'
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1050:in `apply_censor_rules_to_binary!'
spec/models/info_request_spec.rb:497:in `block (4 levels) in <top (required)>'

26)
Spec::Mocks::MockExpectationError in 'InfoRequest when applying censor rules when applying censor rules to binary files should apply a user rule'
Mock "CensorRule_1169" received unexpected message :to_ary with (no args)
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1038:in `flatten'
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1038:in `applicable_censor_rules'
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1050:in `apply_censor_rules_to_binary!'
spec/models/info_request_spec.rb:502:in `block (4 levels) in <top (required)>'

27)
'InfoRequest when applying censor rules when applying censor rules to binary files should not raise an error if there is no user' FAILED
expected no Exception, got #<Spec::Mocks::MockExpectationError: Mock "CensorRule_1175" received unexpected message :to_ary with (no args)>
spec/models/info_request_spec.rb:507:in `block (4 levels) in <top (required)>'

28)
Spec::Mocks::MockExpectationError in 'InfoRequest when applying censor rules when applying censor rules to binary files should apply a rule from the body associated with the request'
Mock "CensorRule_1181" received unexpected message :to_ary with (no args)
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1038:in `flatten'
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1038:in `applicable_censor_rules'
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1050:in `apply_censor_rules_to_binary!'
spec/models/info_request_spec.rb:512:in `block (4 levels) in <top (required)>'

29)
Spec::Mocks::MockExpectationError in 'InfoRequest when applying censor rules when applying censor rules to binary files should apply a request rule'
Mock "CensorRule_1187" received unexpected message :to_ary with (no args)
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1038:in `flatten'
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1038:in `applicable_censor_rules'
/home/mdupont/experiments/alaveteli/app/models/info_request.rb:1050:in `apply_censor_rules_to_binary!'
spec/models/info_request_spec.rb:517:in `block (4 levels) in <top (required)>'

30)
Encoding::CompatibilityError in 'User when indexing users with Xapian should search by name'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/models/xapian_spec.rb:7:in `block (2 levels) in <top (required)>'

31)
Encoding::CompatibilityError in 'User when indexing users with Xapian should search by 'about me' text'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/models/xapian_spec.rb:7:in `block (2 levels) in <top (required)>'

32)
Encoding::CompatibilityError in 'PublicBody when indexing public bodies with Xapian should search index the main name field'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/models/xapian_spec.rb:41:in `block (2 levels) in <top (required)>'

33)
Encoding::CompatibilityError in 'PublicBody when indexing public bodies with Xapian should search index the notes field'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/models/xapian_spec.rb:41:in `block (2 levels) in <top (required)>'

34)
Encoding::CompatibilityError in 'PublicBody when indexing public bodies with Xapian should delete public bodies from the index when they are destroyed'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/models/xapian_spec.rb:41:in `block (2 levels) in <top (required)>'

35)
Encoding::CompatibilityError in 'PublicBody when indexing requests by body they are to should find requests to the body'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/models/xapian_spec.rb:74:in `block (2 levels) in <top (required)>'

36)
Encoding::CompatibilityError in 'PublicBody when indexing requests by body they are to should update index correctly when URL name of body changes'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/models/xapian_spec.rb:74:in `block (2 levels) in <top (required)>'

37)
Encoding::CompatibilityError in 'PublicBody when indexing requests by body they are to should work with URL names that are longer than 64 characters'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/models/xapian_spec.rb:74:in `block (2 levels) in <top (required)>'

38)
Encoding::CompatibilityError in 'User when indexing requests by user they are from should find requests from the user'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/models/xapian_spec.rb:129:in `block (2 levels) in <top (required)>'

39)
Encoding::CompatibilityError in 'User when indexing requests by user they are from should find just the sent message events from a particular user'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/models/xapian_spec.rb:129:in `block (2 levels) in <top (required)>'

40)
Encoding::CompatibilityError in 'User when indexing requests by user they are from should not find it when one of the request's users is changed'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/models/xapian_spec.rb:129:in `block (2 levels) in <top (required)>'

41)
Encoding::CompatibilityError in 'User when indexing requests by user they are from should not get confused searching for requests when one user has a name which has same stem as another'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/models/xapian_spec.rb:129:in `block (2 levels) in <top (required)>'

42)
Encoding::CompatibilityError in 'User when indexing requests by user they are from should update index correctly when URL name of user changes'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/models/xapian_spec.rb:129:in `block (2 levels) in <top (required)>'

43)
Encoding::CompatibilityError in 'User when indexing comments by user they are by should find requests from the user'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/models/xapian_spec.rb:207:in `block (2 levels) in <top (required)>'

44)
Encoding::CompatibilityError in 'User when indexing comments by user they are by should update index correctly when URL name of user changes'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/models/xapian_spec.rb:207:in `block (2 levels) in <top (required)>'

45)
Encoding::CompatibilityError in 'InfoRequest when indexing requests by their title should find events for the request'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/models/xapian_spec.rb:242:in `block (2 levels) in <top (required)>'

46)
Encoding::CompatibilityError in 'InfoRequest when indexing requests by their title should update index correctly when URL title of request changes'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/models/xapian_spec.rb:242:in `block (2 levels) in <top (required)>'

47)
Encoding::CompatibilityError in 'InfoRequest when indexing requests by tag should find request by tag, even when changes'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/models/xapian_spec.rb:271:in `block (2 levels) in <top (required)>'

48)
Encoding::CompatibilityError in 'PublicBody when indexing authorities by tag should find request by tag, even when changes'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/models/xapian_spec.rb:292:in `block (2 levels) in <top (required)>'

49)
Encoding::CompatibilityError in 'PublicBody when only indexing selected things on a rebuild should only index what we ask it to'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/models/xapian_spec.rb:316:in `block (2 levels) in <top (required)>'

50)
Encoding::CompatibilityError in 'RequestController when listing recent requests should be successful'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/request_controller_spec.rb:8:in `block (2 levels) in <top (required)>'

51)
Encoding::CompatibilityError in 'RequestController when listing recent requests should render with 'list' template'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/request_controller_spec.rb:8:in `block (2 levels) in <top (required)>'

52)
Encoding::CompatibilityError in 'RequestController when listing recent requests should filter requests'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/request_controller_spec.rb:8:in `block (2 levels) in <top (required)>'

53)
Encoding::CompatibilityError in 'RequestController when listing recent requests should filter requests by date'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/request_controller_spec.rb:8:in `block (2 levels) in <top (required)>'

54)
Encoding::CompatibilityError in 'RequestController when listing recent requests should make a sane-sized cache tag'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/request_controller_spec.rb:8:in `block (2 levels) in <top (required)>'

55)
Encoding::CompatibilityError in 'RequestController when listing recent requests should vary the cache tag with locale'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/request_controller_spec.rb:8:in `block (2 levels) in <top (required)>'

56)
Encoding::CompatibilityError in 'RequestController when listing recent requests should list internal_review requests as unresolved ones'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/request_controller_spec.rb:8:in `block (2 levels) in <top (required)>'

57)
Encoding::CompatibilityError in 'RequestController when listing recent requests should assign the first page of results'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/request_controller_spec.rb:8:in `block (2 levels) in <top (required)>'

58)
Encoding::CompatibilityError in 'RequestController when listing recent requests should return 404 for pages we don't want to serve up'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/request_controller_spec.rb:8:in `block (2 levels) in <top (required)>'

59)
Encoding::CompatibilityError in 'RequestController when listing recent requests should not raise an error for a page param of less than zero, but should treat it as
        a param of 1'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/request_controller_spec.rb:8:in `block (2 levels) in <top (required)>'

60)
ActionView::TemplateError in 'RequestController when showing one request when handling incoming mail should convert message body to UTF8'
incompatible encoding regexp match (Windows-31J regexp with UTF-8 string)
On line #11 of app/views/request/_correspondence.rhtml

    8: %>
    9:     <div class="incoming correspondence" id="incoming-<%=incoming_message.id.to_s%>">
    10:         <h2>
    11:             <% if !incoming_message.safe_mail_from.nil? && incoming_message.safe_mail_from.strip != @info_request.public_body.name.strip %>
    12:                 <%= _("From:") %> <%=h incoming_message.safe_mail_from %><br>
    13:             <% end %>
    14:             <% if incoming_message.safe_mail_from.nil? || (incoming_message.mail_from_domain == @info_request.public_body.request_email_domain) %>

    app/models/incoming_message.rb:706:in `scan'
    app/models/incoming_message.rb:706:in `_uudecode_and_save_attachments'
    app/models/incoming_message.rb:806:in `extract_attachments!'
    app/models/incoming_message.rb:132:in `block in parse_raw_email!'
    app/models/incoming_message.rb:131:in `parse_raw_email!'
    app/models/incoming_message.rb:172:in `mail_from'
    app/models/incoming_message.rb:176:in `safe_mail_from'
    app/views/request/_correspondence.rhtml:11:in `_run_rhtml_app47views47request47_correspondence46rhtml_locals_correspondence_info_request_event_object'
    /home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/rspec-rails-1.3.4/lib/spec/rails/extensions/action_view/base.rb:17:in `rescue in render_partial_with_base_view_path_handling'
    /home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/rspec-rails-1.3.4/lib/spec/rails/extensions/action_view/base.rb:14:in `render_partial_with_base_view_path_handling'
    /home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/rspec-rails-1.3.4/lib/spec/rails/extensions/action_view/base.rb:29:in `render_with_mock_proxy'
    app/views/request/show.rhtml:138:in `block in _run_rhtml_app47views47request47show46rhtml'
    /home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/will_paginate-2.3.16/lib/will_paginate/finder.rb:168:in `block in method_missing_with_paginate'
    /home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/will_paginate-2.3.16/lib/will_paginate/finder.rb:168:in `method_missing_with_paginate'
    app/views/request/show.rhtml:136:in `_run_rhtml_app47views47request47show46rhtml'
    /home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/rspec-rails-1.3.4/lib/spec/rails/extensions/action_view/base.rb:29:in `render_with_mock_proxy'
    /home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/rspec-rails-1.3.4/lib/spec/rails/extensions/action_view/base.rb:29:in `render_with_mock_proxy'
    /home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/rspec-rails-1.3.4/lib/spec/rails/example/controller_example_group.rb:233:in `render'
    app/controllers/request_controller.rb:120:in `block (3 levels) in show'
    app/controllers/request_controller.rb:119:in `block in show'
    app/controllers/request_controller.rb:55:in `show'
    app/controllers/application_controller.rb:100:in `record_memory'
    spec/controllers/request_controller_spec.rb:519:in `block (3 levels) in <top (required)>'
    rspec (1.3.2) lib/spec/example/example_methods.rb:40:in `instance_eval'
    rspec (1.3.2) lib/spec/example/example_methods.rb:40:in `block in execute'
    /home/mdupont/.rvm/rubies/ruby-1.9.2-p320/lib/ruby/1.9.1/timeout.rb:44:in `timeout'
    rspec (1.3.2) lib/spec/example/example_methods.rb:37:in `execute'
    rspec (1.3.2) lib/spec/example/example_group_methods.rb:219:in `block in run_examples'
    rspec (1.3.2) lib/spec/example/example_group_methods.rb:217:in `each'
    rspec (1.3.2) lib/spec/example/example_group_methods.rb:217:in `run_examples'
    rspec (1.3.2) lib/spec/example/example_group_methods.rb:103:in `run'
    rspec (1.3.2) lib/spec/runner/example_group_runner.rb:23:in `block in run'
    rspec (1.3.2) lib/spec/runner/example_group_runner.rb:22:in `each'
    rspec (1.3.2) lib/spec/runner/example_group_runner.rb:22:in `run'
    rspec (1.3.2) lib/spec/runner/options.rb:153:in `run_examples'
    rspec (1.3.2) lib/spec/runner/command_line.rb:9:in `run'
    rspec (1.3.2) bin/spec:5:in `<main>'

61)
Encoding::UndefinedConversionError in 'RequestController when showing one request when handling incoming mail should generate valid HTML verson of PDF attachments'
"\xE2" from ASCII-8BIT to UTF-8
/home/mdupont/experiments/alaveteli/app/models/foi_attachment.rb:315:in `block in body_as_html'
/home/mdupont/experiments/alaveteli/app/models/foi_attachment.rb:313:in `chdir'
/home/mdupont/experiments/alaveteli/app/models/foi_attachment.rb:313:in `body_as_html'
/home/mdupont/experiments/alaveteli/app/controllers/request_controller.rb:754:in `get_attachment_as_html'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionpack-2.3.14/lib/action_controller/base.rb:1333:in `perform_action'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionpack-2.3.14/lib/action_controller/filters.rb:617:in `call_filters'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionpack-2.3.14/lib/action_controller/filters.rb:638:in `block in run_before_filters'
/home/mdupont/experiments/alaveteli/app/controllers/request_controller.rb:704:in `cache_attachments'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activesupport-2.3.14/lib/active_support/callbacks.rb:178:in `evaluate_method'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionpack-2.3.14/lib/action_controller/filters.rb:186:in `call'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionpack-2.3.14/lib/action_controller/filters.rb:635:in `run_before_filters'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionpack-2.3.14/lib/action_controller/filters.rb:615:in `call_filters'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionpack-2.3.14/lib/action_controller/filters.rb:638:in `block in run_before_filters'
/home/mdupont/experiments/alaveteli/app/controllers/application_controller.rb:100:in `record_memory'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activesupport-2.3.14/lib/active_support/callbacks.rb:178:in `evaluate_method'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionpack-2.3.14/lib/action_controller/filters.rb:186:in `call'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionpack-2.3.14/lib/action_controller/filters.rb:635:in `run_before_filters'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionpack-2.3.14/lib/action_controller/filters.rb:615:in `call_filters'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionpack-2.3.14/lib/action_controller/filters.rb:610:in `perform_action_with_filters'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionpack-2.3.14/lib/action_controller/benchmarking.rb:68:in `block in perform_action_with_benchmark'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activesupport-2.3.14/lib/active_support/core_ext/benchmark.rb:17:in `block in ms'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activesupport-2.3.14/lib/active_support/core_ext/benchmark.rb:17:in `ms'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionpack-2.3.14/lib/action_controller/benchmarking.rb:68:in `perform_action_with_benchmark'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionpack-2.3.14/lib/action_controller/rescue.rb:160:in `perform_action_with_rescue'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionpack-2.3.14/lib/action_controller/flash.rb:151:in `perform_action_with_flash'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionpack-2.3.14/lib/action_controller/base.rb:532:in `process'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionpack-2.3.14/lib/action_controller/filters.rb:606:in `process_with_filters'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionpack-2.3.14/lib/action_controller/test_process.rb:567:in `process_with_test'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionpack-2.3.14/lib/action_controller/test_process.rb:447:in `process'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionpack-2.3.14/lib/action_controller/test_process.rb:398:in `get'
spec/controllers/request_controller_spec.rb:592:in `block (3 levels) in <top (required)>'

62)
NoMethodError in 'RequestController when searching for an authority should return matching bodies'
You have a nil object when you didn't expect it!
You might have expected an instance of ActiveRecord::Base.
The error occurred while evaluating nil.[]
spec/controllers/request_controller_spec.rb:892:in `block (2 levels) in <top (required)>'

63)
Encoding::CompatibilityError in 'RequestController authority uploads a response from the web interface should let the authority upload a file'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:706:in `scan'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:706:in `_uudecode_and_save_attachments'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:806:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:738:in `get_attachments_for_display'
spec/controllers/request_controller_spec.rb:2074:in `block (2 levels) in <top (required)>'

64)
'RequestController when doing type ahead searches should return a request matching the given keyword, but not users with a matching description' FAILED
expected: 1,
     got: 0 (using ==)
spec/controllers/request_controller_spec.rb:2113:in `block (2 levels) in <top (required)>'

65)
ArgumentError in 'RequestController when doing type ahead searches should return all requests matching any of the given keywords'
comparison of InfoRequest with InfoRequest failed
spec/controllers/request_controller_spec.rb:2124:in `block (2 levels) in <top (required)>'

66)
'RequestController when doing type ahead searches should do partial matches for longer words' FAILED
expected: 1,
     got: 0 (using ==)
spec/controllers/request_controller_spec.rb:2136:in `block (2 levels) in <top (required)>'

67)
'RequestController when doing type ahead searches should return all requests matching any of the given keywords' FAILED
expected: 1,
     got: 0 (using ==)
spec/controllers/request_controller_spec.rb:2155:in `block (2 levels) in <top (required)>'

68)
ArgumentError in 'RequestController when showing similar requests should show similar requests'
comparison of InfoRequest with InfoRequest failed
spec/controllers/request_controller_spec.rb:2173:in `block (2 levels) in <top (required)>'

69)
Encoding::CompatibilityError in 'UserController when showing a user should be successful'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/user_controller_spec.rb:11:in `block (2 levels) in <top (required)>'

70)
Encoding::CompatibilityError in 'UserController when showing a user should redirect to lower case name if given one with capital letters'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/user_controller_spec.rb:11:in `block (2 levels) in <top (required)>'

71)
Encoding::CompatibilityError in 'UserController when showing a user should render with 'show' template'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/user_controller_spec.rb:11:in `block (2 levels) in <top (required)>'

72)
Encoding::CompatibilityError in 'UserController when showing a user should distinguish between 'my profile' and 'my requests' for logged in users'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/user_controller_spec.rb:11:in `block (2 levels) in <top (required)>'

73)
Encoding::CompatibilityError in 'UserController when showing a user should assign the user'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/user_controller_spec.rb:11:in `block (2 levels) in <top (required)>'

74)
Encoding::CompatibilityError in 'UserController when showing a user should search the user's contributions'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/user_controller_spec.rb:11:in `block (2 levels) in <top (required)>'

75)
Encoding::CompatibilityError in 'UserController when showing a user should not show unconfirmed users'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/user_controller_spec.rb:11:in `block (2 levels) in <top (required)>'

76)
Encoding::CompatibilityError in 'UserController when viewing the wall should show users stuff on their wall, most recent first'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/user_controller_spec.rb:637:in `block (2 levels) in <top (required)>'

77)
Encoding::CompatibilityError in 'UserController when viewing the wall should show other users' activities on their walls'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/user_controller_spec.rb:637:in `block (2 levels) in <top (required)>'

78)
Encoding::CompatibilityError in 'UserController when viewing the wall should allow users to turn their own email alerts on and off'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/user_controller_spec.rb:637:in `block (2 levels) in <top (required)>'

79)
Encoding::CompatibilityError in 'TrackController when sending alerts for a track should send alerts'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/track_controller_spec.rb:64:in `block (2 levels) in <top (required)>'

80)
Encoding::CompatibilityError in 'TrackController when sending alerts for a track should send localised alerts'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/track_controller_spec.rb:64:in `block (2 levels) in <top (required)>'

81)
Encoding::CompatibilityError in 'TrackController when viewing RSS feed for a track should get the RSS feed'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/track_controller_spec.rb:141:in `block (2 levels) in <top (required)>'

82)
Encoding::CompatibilityError in 'TrackController when viewing RSS feed for a track should return NotFound for a non-existent user'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/track_controller_spec.rb:141:in `block (2 levels) in <top (required)>'

83)
Encoding::CompatibilityError in 'TrackController when viewing JSON version of a track feed should get the feed'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/track_controller_spec.rb:171:in `block (2 levels) in <top (required)>'

84)
Encoding::CompatibilityError in 'TrackController when tracking a public body should work'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/track_controller_spec.rb:213:in `block (2 levels) in <top (required)>'

85)
Encoding::CompatibilityError in 'TrackController when tracking a public body should filter by event type'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/track_controller_spec.rb:213:in `block (2 levels) in <top (required)>'

86)
Encoding::CompatibilityError in 'ApiController when using the API should allow files to be attached to a response'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:706:in `scan'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:706:in `_uudecode_and_save_attachments'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:806:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:164:in `sent_at'
spec/controllers/api_controller_spec.rb:241:in `block (2 levels) in <top (required)>'

87)
Encoding::CompatibilityError in 'GeneralController when searching should render the front page successfully'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

88)
Encoding::CompatibilityError in 'GeneralController when searching should render the front page with default language'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

89)
Encoding::CompatibilityError in 'GeneralController when searching should render the front page with default language'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

90)
Encoding::CompatibilityError in 'GeneralController when searching should render the front page with default language and ignore the browser setting'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

91)
Encoding::CompatibilityError in 'GeneralController when searching should render the front page with browser-selected language when there's no default set'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

92)
Encoding::CompatibilityError in 'GeneralController when searching doesn't raise an error when there's no user matching the one in the session'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

93)
Encoding::CompatibilityError in 'GeneralController when searching should redirect from search query URL to pretty URL'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

94)
Encoding::CompatibilityError in 'GeneralController when searching should filter results based on end of URL being 'all''
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

95)
Encoding::CompatibilityError in 'GeneralController when searching should filter results based on end of URL being 'users''
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

96)
Encoding::CompatibilityError in 'GeneralController when searching should filter results based on end of URL being 'requests''
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

97)
Encoding::CompatibilityError in 'GeneralController when searching should filter results based on end of URL being 'bodies''
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

98)
Encoding::CompatibilityError in 'GeneralController when searching should show help when searching for nothing'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

99)
Encoding::CompatibilityError in 'GeneralController when searching should not show unconfirmed users'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

100)
Encoding::CompatibilityError in 'GeneralController when searching should show newly-confirmed users'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

101)
Encoding::CompatibilityError in 'GeneralController when searching should show tracking links for requests-only searches'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

102)
Encoding::CompatibilityError in 'GeneralController when searching when using different locale settings should generate URLs with a locale prepended when there's more than one locale set'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

103)
Encoding::CompatibilityError in 'GeneralController when searching when using different locale settings should use our test PO files rather than the application one'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

104)
Encoding::CompatibilityError in 'GeneralController when searching when using different locale settings should generate URLs that include the locale when using one that includes an underscore'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

105)
Encoding::CompatibilityError in 'GeneralController when searching when using different locale settings should fall back to the language if the territory is unknown'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

106)
Encoding::CompatibilityError in 'GeneralController when searching when using different locale settings should generate URLs without a locale prepended when there's only one locale set'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

107)
Encoding::CompatibilityError in 'GeneralController when searching when constructing the list of recent requests should list the newest successful request first'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

108)
Encoding::CompatibilityError in 'GeneralController when searching when constructing the list of recent requests should coalesce duplicate requests'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

109)
Encoding::CompatibilityError in 'GeneralController when searching when using xapian search should find info request when searching for '"fancy dog"''
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

110)
Encoding::CompatibilityError in 'GeneralController when searching when using xapian search should find public body and incoming message when searching for 'geraldine quango''
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/general_controller_spec.rb:41:in `block (2 levels) in <top (required)>'

111)
Encoding::CompatibilityError in 'PublicBodyController when showing a body should be successful'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/public_body_controller_spec.rb:9:in `block (2 levels) in <top (required)>'

112)
Encoding::CompatibilityError in 'PublicBodyController when showing a body should render with 'show' template'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/public_body_controller_spec.rb:9:in `block (2 levels) in <top (required)>'

113)
Encoding::CompatibilityError in 'PublicBodyController when showing a body should assign the body'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/public_body_controller_spec.rb:9:in `block (2 levels) in <top (required)>'

114)
Encoding::CompatibilityError in 'PublicBodyController when showing a body should assign the requests (1)'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/public_body_controller_spec.rb:9:in `block (2 levels) in <top (required)>'

115)
Encoding::CompatibilityError in 'PublicBodyController when showing a body should assign the requests (2)'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/public_body_controller_spec.rb:9:in `block (2 levels) in <top (required)>'

116)
Encoding::CompatibilityError in 'PublicBodyController when showing a body should assign the requests (3)'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/public_body_controller_spec.rb:9:in `block (2 levels) in <top (required)>'

117)
Encoding::CompatibilityError in 'PublicBodyController when showing a body should assign the body using different locale from that used for url_name'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/public_body_controller_spec.rb:9:in `block (2 levels) in <top (required)>'

118)
Encoding::CompatibilityError in 'PublicBodyController when showing a body should assign the body using same locale as that used in url_name'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/public_body_controller_spec.rb:9:in `block (2 levels) in <top (required)>'

119)
Encoding::CompatibilityError in 'PublicBodyController when showing a body should redirect use to the relevant locale even when url_name is for a different locale'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/public_body_controller_spec.rb:9:in `block (2 levels) in <top (required)>'

120)
Encoding::CompatibilityError in 'PublicBodyController when showing a body should redirect to newest name if you use historic name of public body in URL'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/public_body_controller_spec.rb:9:in `block (2 levels) in <top (required)>'

121)
Encoding::CompatibilityError in 'PublicBodyController when showing a body should redirect to lower case name if you use mixed case name in URL'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/public_body_controller_spec.rb:9:in `block (2 levels) in <top (required)>'

122)
Encoding::CompatibilityError in 'PublicBodyController when doing type ahead searches should return nothing for the empty query string'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/public_body_controller_spec.rb:200:in `block (2 levels) in <top (required)>'

123)
Encoding::CompatibilityError in 'PublicBodyController when doing type ahead searches should return a body matching the given keyword, but not users with a matching description'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/public_body_controller_spec.rb:200:in `block (2 levels) in <top (required)>'

124)
Encoding::CompatibilityError in 'PublicBodyController when doing type ahead searches should return all requests matching any of the given keywords'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/public_body_controller_spec.rb:200:in `block (2 levels) in <top (required)>'

125)
Encoding::CompatibilityError in 'PublicBodyController when doing type ahead searches should return requests matching the given keywords in any of their locales'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/public_body_controller_spec.rb:200:in `block (2 levels) in <top (required)>'

126)
Encoding::CompatibilityError in 'PublicBodyController when doing type ahead searches should not return  matches for short words'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/controllers/public_body_controller_spec.rb:200:in `block (2 levels) in <top (required)>'

127)
TypeError in 'ApplicationController when caching fragments should not fail with long filenames'
can't convert Symbol into Integer
/home/mdupont/experiments/alaveteli/app/controllers/application_controller.rb:193:in `[]'
/home/mdupont/experiments/alaveteli/app/controllers/application_controller.rb:193:in `foi_fragment_cache_part_path'
/home/mdupont/experiments/alaveteli/app/controllers/application_controller.rb:200:in `foi_fragment_cache_path'
spec/controllers/application_controller_spec.rb:42:in `block (2 levels) in <top (required)>'

128)
'When filtering should not fail when not in test mode' FAILED
expected: "",
     got: "/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activesupport-2.3.14/lib/active_support/dependencies.rb:182:in `require': no such file to load -- config/boot (MissingSourceFile)\n\tfrom /home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activesupport-2.3.14/lib/active_support/dependencies.rb:182:in `block in require'\n\tfrom /home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activesupport-2.3.14/lib/active_support/dependencies.rb:547:in `new_constants_in'\n\tfrom /home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activesupport-2.3.14/lib/active_support/dependencies.rb:182:in `require'\n\tfrom ./handle-mail-replies.rb:170:in `load_rails'\n\tfrom ./handle-mail-replies.rb:175:in `record_bounce'\n\tfrom ./handle-mail-replies.rb:42:in `block (2 levels) in main'\n\tfrom ./handle-mail-replies.rb:41:in `each'\n\tfrom ./handle-mail-replies.rb:41:in `block in main'\n\tfrom ./handle-mail-replies.rb:26:in `chdir'\n\tfrom ./handle-mail-replies.rb:26:in `main'\n\tfrom ./handle-mail-replies.rb:180:in `<main>'\n" (using ==)
spec/script/handle-mail-replies_spec.rb:18:in `block (2 levels) in <top (required)>'

129)
RuntimeError in 'when viewing a body should be valid HTML'
HTML validation error in /tmp/railshtmlvalidate.16673.1.html HTTP status: 200
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:133:in `validate_html'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:142:in `validate_as_body'
spec/views/public_body/show.rhtml_spec.rb:43:in `block (2 levels) in <top (required)>'

130)
Encoding::CompatibilityError in 'When searching should not strip quotes from quoted query'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/integration/search_request_spec.rb:7:in `block (2 levels) in <top (required)>'

131)
Encoding::CompatibilityError in 'When searching should redirect requests with search in query string to URL-based page'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/integration/search_request_spec.rb:7:in `block (2 levels) in <top (required)>'

132)
Encoding::CompatibilityError in 'When searching should correctly execute simple search'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/integration/search_request_spec.rb:7:in `block (2 levels) in <top (required)>'

133)
Encoding::CompatibilityError in 'When searching should correctly filter searches for requests'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/integration/search_request_spec.rb:7:in `block (2 levels) in <top (required)>'

134)
Encoding::CompatibilityError in 'When searching should correctly filter searches for users'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/integration/search_request_spec.rb:7:in `block (2 levels) in <top (required)>'

135)
Encoding::CompatibilityError in 'When searching should correctly filter searches for successful requests'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/integration/search_request_spec.rb:7:in `block (2 levels) in <top (required)>'

136)
Encoding::CompatibilityError in 'When searching should correctly filter searches for comments'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `block in parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `each'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:212:in `parse_all_incoming_messages'
/home/mdupont/experiments/alaveteli/spec/spec_helper.rb:112:in `rebuild_xapian_index'
spec/integration/search_request_spec.rb:7:in `block (2 levels) in <top (required)>'

137)
'When rendering errors should render a 404 for users that don't exist' FAILED
expected: "404",
     got: "500" (using ==)
spec/integration/errors_spec.rb:21:in `block (2 levels) in <top (required)>'

138)
'When rendering errors should render a 404 for bodies that don't exist' FAILED
expected: "404",
     got: "500" (using ==)
spec/integration/errors_spec.rb:25:in `block (2 levels) in <top (required)>'

139)
'When rendering errors should render a 403 for attempts at directory listing for attachments' FAILED
expected: "403",
     got: "500" (using ==)
spec/integration/errors_spec.rb:39:in `block (2 levels) in <top (required)>'

140)
'When rendering errors should render a 404 for non-existent 'details' pages for requests' FAILED
expected: "404",
     got: "500" (using ==)
spec/integration/errors_spec.rb:45:in `block (2 levels) in <top (required)>'

141)
Encoding::CompatibilityError in 'when using TMail should load an email with funny MIME settings'
incompatible encoding regexp match (Windows-31J regexp with ASCII-8BIT string)
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `gsub'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:81:in `mail'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:467:in `get_attachment_leaves'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:749:in `extract_attachments!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:132:in `block in parse_raw_email!'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/connection_adapters/abstract/database_statements.rb:136:in `transaction'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/activerecord-2.3.14/lib/active_record/transactions.rb:182:in `transaction'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:131:in `parse_raw_email!'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:603:in `get_main_body_text_internal'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:564:in `_cache_main_body_text'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:597:in `get_main_body_text_unfolded'
/home/mdupont/experiments/alaveteli/app/models/incoming_message.rb:823:in `get_body_for_html_display'
spec/lib/tmail_extensions_spec.rb:27:in `block (2 levels) in <top (required)>'

142)
Encoding::CompatibilityError in 'when using TMail should convert to utf8'
incompatible character encodings: UTF-8 and ASCII-8BIT
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionmailer-2.3.14/lib/action_mailer/vendor/tmail-1.2.7/tmail/quoting.rb:82:in `gsub'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionmailer-2.3.14/lib/action_mailer/vendor/tmail-1.2.7/tmail/quoting.rb:82:in `unquote_and_convert_to'
/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/actionmailer-2.3.14/lib/action_mailer/vendor/tmail-1.2.7/tmail/quoting.rb:9:in `subject'
spec/lib/tmail_extensions_spec.rb:40:in `block (2 levels) in <top (required)>'

Finished in 224.471178171 seconds

853 examples, 142 failures
rake aborted!
Command /home/mdupont/.rvm/rubies/ruby-1.9.2-p320/bin/ruby -I"lib"  "/home/mdupont/.rvm/gems/ruby-1.9.2-p320/gems/rspec-1.3.2/bin/spec" "spec/helpers/link_to_helper_spec.rb" "spec/models/request_mailer_spec.rb" "spec/models/track_mailer_spec.rb" "spec/models/outgoing_message_spec.rb" "spec/models/public_body_spec.rb" "spec/models/profile_photo_spec.rb" "spec/models/track_thing_spec.rb" "spec/models/raw_email_spec.rb" "spec/models/foi_attachment_spec.rb" "spec/models/user_info_request_sent_alert_spec.rb" "spec/models/contact_mailer_spec.rb" "spec/models/mail_server_log_spec.rb" "spec/models/incoming_message_spec.rb" "spec/models/info_request_event_spec.rb" "spec/models/has_tag_string_tag_spec.rb" "spec/models/purge_request_spec.rb" "spec/models/contact_validator_spec.rb" "spec/models/application_mailer_spec.rb" "spec/models/user_spec.rb" "spec/models/post_redirect_spec.rb" "spec/models/holiday_spec.rb" "spec/models/user_mailer_spec.rb" "spec/models/info_request_spec.rb" "spec/models/xapian_spec.rb" "spec/models/censor_rule_spec.rb" "spec/models/outgoing_mailer_spec.rb" "spec/models/track_things_sent_email_spec.rb" "spec/controllers/help_controller_spec.rb" "spec/controllers/request_controller_spec.rb" "spec/controllers/admin_censor_rule_controller_spec.rb" "spec/controllers/user_controller_spec.rb" "spec/controllers/admin_public_body_controller_spec.rb" "spec/controllers/track_controller_spec.rb" "spec/controllers/request_game_controller_spec.rb" "spec/controllers/admin_general_controller_spec.rb" "spec/controllers/admin_user_controller_spec.rb" "spec/controllers/api_controller_spec.rb" "spec/controllers/general_controller_spec.rb" "spec/controllers/public_body_controller_spec.rb" "spec/controllers/services_controller_spec.rb" "spec/controllers/admin_track_controller_spec.rb" "spec/controllers/comment_controller_spec.rb" "spec/controllers/admin_request_controller_spec.rb" "spec/controllers/application_controller_spec.rb" "spec/script/handle-mail-replies_spec.rb" "spec/views/request_game/play.rhtml_spec.rb" "spec/views/request/_after_actions.rhtml_spec.rb" "spec/views/request/show.rhtml_spec.rb" "spec/views/request/list.rhtml_spec.rb" "spec/views/request/_describe_state.rhtml_spec.rb" "spec/views/public_body/show.rhtml_spec.rb" "spec/integration/view_request_spec.rb" "spec/integration/search_request_spec.rb" "spec/integration/admin_spec.rb" "spec/integration/create_request_spec.rb" "spec/integration/errors_spec.rb" "spec/lib/tmail_extensions_spec.rb" "spec/lib/sendmail_return_path_spec.rb" "spec/lib/timezone_fixes_spec.rb" "spec/lib/whatdotheyknow/strip_empty_sessions_spec.rb" "spec/lib/public_body_categories_spec.rb" --options "/home/mdupont/experiments/alaveteli/spec/spec.opts" failed

Tasks: TOP => default => spec
(See full trace by running task with --trace)
